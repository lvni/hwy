<!doctype html><html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
<META NAME="MobileOptimized" CONTENT="240">
<title>活动</title>
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/myfootprint.css">
</head>

<body>
<div class="u-top-msg">
    <div class="title">
        <p>活动</p>
    </div>
    <a href="message.html" class="msgbox">
        <img src="../img/hw_03.png">
        <span class="msg"></span>
    </a>
    <a href="javascript:history.go(-1)" class="turnback">
        <img src="../img/arrowleft.png">
    </a>
</div>
<div class="u-productlist">

    
</div>
<div id="loading-more" style=" clear: both;text-align: center;">
</div>

<script type="text/template" id="list_item_template">
<div class="contbox" onclick="javascript:location.href='details.html?id={$goods_id}'">
        <img src="{$goods_thumb}">
        <div class="cont">
            <p class="name">{$goods_name}</p>
            <p class="other"><span class="money"><i>￥</i>{$goods_price}</span><span class="collection"><img src="../img/hongwu_66.png"> {$fav_count}人收藏</span></p>
        </div>
    </div>
</script>
<script src="../javascripts/zepto.min.js"></script>
<script src="../javascripts/main.js"></script>
<script>
$(function(){

    var page = 1;
    var pageCnt = 0;
    var loading = 0;
    function loadList(p) {
        Util.requestApi("?r=activity/yuanlai", {p:p}, function(data){
            if (data.errno) {
                messageBox.toast(data.errmsg);
                return;
            }
            if (data.data.page_count == 0) {
                Util.showTips($(".u-productlist"), "没有相关商品");
                return ;
            }
            var template = $("#list_item_template").html();
            var html = "";
            for (i in data.data.list) {
                var item = data.data.list[i];
                html += Template.renderByTemplate(template, item);
            }
            page = data.data.page ;
            pageCnt = data.data.page_count;
            $(".u-productlist").append(html);
            if ( page >= pageCnt) {
                $("#loading-more").html("没有更多");
            }
            loading = 0;
        });
        
        
    }
    
    $(window).scroll(function(){
            if (page < pageCnt && loading == 0) {
                    $("#loading-more").html("加载中 ...");
                    loading = 1;
                    loadList(page + 1);
            }
        });
        loadList(page );
});
</script>
</body>
</html>
