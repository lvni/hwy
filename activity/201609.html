<!doctype html><html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
<META NAME="MobileOptimized" CONTENT="240">
<title>活动</title>
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/myfootprint.css">
    <link rel="stylesheet" href="../css/index.css">
    
    <style>
        .main_bnt {
            display: -webkit-box;
            background: #b30011;
            color: white;
            border-radius: 3px;
            padding: 2px;
        }
        .gray { 
            background: #ccc;
            color: white;
        }
        .draw_navi {
            height: 40px;
            line-height: 40px;
            background: #fff;
            padding-left: 10px;
            color: #666666;
        }
        .u-nav-autowidth {
            position:static;
        }
    </style>
</head>

<body>
<div class="u-top-msg">
    <div class="title">
        <p>活动</p>
    </div>
    <a href="message.html" class="msgbox">
        <img src="../img/hw_03.png">
        <span class="msg"></span>
    </a>
    <a href="javascript:history.go(-1)" class="turnback">
        <img src="../img/arrowleft.png">
    </a>
</div>
<div class="details-slide indexsilde" >
    <div id="hl-swiper" class="hl-swiper cont">
        <div class="position-nav"></div>
        <div class="slides">
            <div class="slide-list"><a href="javascript:;"><img src="../img/index_21.png" alt=""></a></div>
        </div>
    </div>
</div>

<nav class="u-nav-autowidth">
    <div class="on" data-index="1"> <span>寻缘</span> </div> 
    <div data-index="2"> <span>结缘名单</span></div>
    <div data-index="3"> <span>活动规则</span></div> 
</nav>

<div id="ctx_1" class="box_area">
<div class="u-productlist">

    
</div>
<div id="loading-more" style=" clear: both;text-align: center;">
</div>
</div>
<div id="ctx_2" style="display:none;" class="box_area">
    获奖名单
</div>
<div id="ctx_3" style="display:none;" class="box_area">
    活动规则
</div>
<script type="text/template" id="list_item_template">
<div class="contbox" >
        <img src="{$goods_thumb}" onclick="javascript:location.href='../details.html?id={$goods_id}&rf=act201609'">
        <div class="cont">
            <p class="name">{$goods_name}</p>
            <p class="other"><span class="money"><i>￥</i>{$goods_price}</span><span class="collection  "><a class="main_bnt" href="javascript:;">立即参与</a></p>
        </div>
    </div>
</script>
<script src="../javascripts/zepto.min.js"></script>
<script src="../javascripts/main.js"></script>
<script>
$(function(){

    var page = 1;
    var pageCnt = 0;
    var loading = 0;
    var UserAI = {};
    function loadList(p) {
        Util.requestApi("?r=activity/yuanlai", {p:p}, function(data){
            if (data.errno) {
                messageBox.toast(data.errmsg);
                return;
            }
            if (data.data.page_count == 0) {
                Util.showTips($(".u-productlist"), "没有相关商品");
                return ;
            }
            var template = $("#list_item_template").html();
            var html = "";
            for (i in data.data.list) {
                var item = data.data.list[i];
                html += Template.renderByTemplate(template, item);
            }
            page = data.data.page ;
            pageCnt = data.data.page_count;
            $(".u-productlist").append(html);
            if ( page >= pageCnt) {
                $("#loading-more").html("没有更多");
            }
            loading = 0;
        });
        
        
    }
    
    $(window).scroll(function(){
            if (page < pageCnt && loading == 0) {
                    $("#loading-more").html("加载中 ...");
                    loading = 1;
                    loadList(page + 1);
            }
        });
        loadList(page );
        
    //获取用户活动参与情况
    Util.requestApi("?r=activity/getuserai", {}, function(data){
        console.log(data);
    }, 'GET', false);
    
    $(".u-nav-autowidth div").click(function(){
        $(".u-nav-autowidth div").removeClass("on");
        $(this).addClass("on");
        var idex = $(this).attr("data-index");
        $(".box_area").hide();
        $("#ctx_" + idex).show();
    });
});
</script>
</body>
</html>
