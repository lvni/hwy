function ElementCreator(a,b){this.element=document.createElement(a);for(var c in b)this.element.setAttribute(c,b[c]);return this.element}function getDefaultStyle(a,b){return document.defaultView.getComputedStyle(a,!1)[b]}Object.extend=function(a,b){for(var c in b)a[c]=b[c];return a};var SelectorStyle=".selector-mask,.selector-persp{width:100%;height:100%;position:absolute;top:0;left:0;z-index:1001}.selector-mask{background:#000;opacity:.7;filter:Alpha(Opacity=70)}.selector-bg{background:#fff;border-radius:3px;-webkit-border-radius:3px}.selector-box{position:relative;z-index:1001;font-family:arial,verdana,sans-serif;font-size:12px;text-shadow:none;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-ms-touch-action:none;-webkit-tap-highlight-color:transparent;padding:0;color:#31b6e7;background:#f5f5f5}.select-wr{min-width:170px;zoom:1;padding:0;text-align:center}.select-title{height:36px;line-height:36px;padding:0;border-bottom:2px solid #31b6e7;font-size:18px}.select-hl{padding:1px 10px}.select-c{float:none;margin:0;display:inline-block}.select-wc{margin:0;padding:0 2px;position:relative;background:#000;zoom:1}.select-rc{-webkit-border-radius:3px;border-radius:3px}.select-sc .select-wl{position:relative;background:#888;background:linear-gradient(#000 0,#333 35%,#888 50%,#333 65%,#000 100%);background:-webkit-gradient(linear,left bottom,left top,from(#000),color-stop(.35,#333),color-stop(.5,#888),color-stop(.65,#333),to(#000));background:-moz-linear-gradient(#000 0,#333 35%,#888 50%,#333 65%,#000 100%);background:-o-linear-gradient(#000 0,#333 35%,#888 50%,#333 65%,#000 100%);float:left;margin:0 2px}.select-w,.selector-box .select-pm .select-w,.selector-box .select-pm .select-wl{border:0}.select-sc .select-w{color:#fff;height:180px;}.select-w{margin:0 2px;overflow:hidden;position:relative}.selector-ul{position:relative;z-index:2}.select-wo{position:absolute;z-index:3;top:0;left:0;width:100%;height:100%;background:-webkit-gradient(linear,0 100%,0 0,from(#f5f5f5),color-stop(.48,rgba(245,245,245,0)),color-stop(.52,rgba(245,245,245,0)),to(#f5f5f5))}.selector-box .select-wol{position:absolute;z-index:1;top:50%;width:100%;left:0;height:36px;border-top:2px solid #31b6e7;border-bottom:2px solid #31b6e7;margin-top:-20px;display:block}.select-bc{border-top:1px solid #dbdbdb;padding:0;text-align:center;clear:both}.select-bw{display:inline-block;float:left;width:50%;position:relative;z-index:5}.android-ics.light .select-b-n .select-b,.select-b-s .select-b{border-right:1px solid #dbdbdb}.select-b{color:#000;cursor:pointer;overflow:hidden;display:block;font-size:14px;text-decoration:none;white-space:nowrap;text-overflow:ellipsis;height:36px;line-height:36px;padding:0;margin:0;font-weight:400;text-shadow:none;box-shadow:none;border-radius:0;-webkit-border-radius:0;-webkit-box-shadow:none}.select-bc:after{content:'';display:block;clear:both}.selector-box .select-b,.selector-box .select-pm .select-w,.selector-box .select-w,.selector-box .select-wc,.selector-box .select-wl{background:0 0}.select-w .selector-li{color:#000;font-size:18px;text-shadow:none;height:36px;line-height:36px;}.selector-persp{display: -webkit-box;-webkit-box-align: center;-webkit-box-pack: center;}.select-sc{overflow-x:hidden}",Selector=function(a){var b={cancleText:"取消",setText:"确定",showTitle:!0,title:"",defaultCss:!0,defaultShow:!0};this.opts=Object.extend(b,a),this.modelHtml='<div class="selector-persp"><div class="selector-mask"></div><div class="selector-box selector-bg" id="selector-box"><div class="select-wr">'+(this.opts.showTitle?'<div class="select-title" id="selector-title">{title}</div>':"")+'<div class="select-c select-sc select-hl"><div class="select-wc select-rc" id="selector-slideBox"><div id="select-clear" style="clear:both;"></div></div></div><div class="select-bc"><span class="select-bw select-b-s" id="selector-cancle-btn"><span class="select-b">取消</span></span><span class="select-bw select-b-c" id="selector-set-btn"><span class="select-b">确定</span></span></div></div></div></div>',this.modelAttr={id:"selector-outter","class":"selector-modal",style:"display:"+(b.defaultShow?"block":"none")+";"},this.slideItem='<div class="select-wl select-rc selector-slideItem" id="{slideId}" ><div class="select-w"><div class="selector-ul" id="{slideId}_ul"><div class="selector-bf"></div></div></div></div>',this.selectItem='<div class="selector-li selector-v" {data}><div class="selector-i"><span class="selector-mon">{text}</span></div></div>',this.opacityMark='<div class="select-wo"></div>',this.pickHtml='<div class="select-wol"></div>',this.outter=null,this.box=null,this.title=null,this.slideBox=null,this.pos=new Array,this.doms=new Array,this.liH=0};Selector.prototype={drawModel:function(){if(this.opts.defaultCss){var a=document.createElement("style");a.innerHTML=SelectorStyle,document.body.appendChild(a)}var b=new ElementCreator("div",this.modelAttr);b.innerHTML=this.modelHtml,document.body.appendChild(b),this.outter=document.querySelector("#selector-outter"),this.box=document.querySelector("#selector-box"),this.title=document.querySelector("#selector-title"),this.slideBox=document.querySelector("#selector-slideBox")},show:function(){return null==this.outter?!1:void(this.outter.style.display="block")},hide:function(){return null==this.outter?!1:void(this.outter.style.display="none")},createSlide:function(a,b){b=b||null;var c=document.querySelectorAll(".selector-slideItem"),d="selector-slideItem_"+(c.length||0),e=null,f=this.slideBox.querySelector("#select-clear").cloneNode(!0),g="",h="",i=this;this.slideBox.removeChild(this.slideBox.querySelector("#select-clear")),this.slideBox.innerHTML+=this.slideItem.replace(/{slideId}/g,d),e=document.querySelector("#"+d).querySelector(".selector-bf"),a.map(function(a){g="",h+=i.selectItem;for(var b in a)"text"==b&&(h=h.replace("{text}",a[b])),g+=b+'="'+a[b]+'"';h=h.replace("{data}",g)}),e.innerHTML+=h,document.querySelector("#"+d).querySelector(".select-w").innerHTML+=this.opacityMark+this.pickHtml,"undefined"==typeof this.pos[d]&&(this.pos[d]=new Object),this.pos[d].liH=parseFloat(getDefaultStyle(this.slideBox.querySelector(".selector-li"),"height"));var j=2*this.pos[d].liH;document.querySelector("#"+d+"_ul").style["-webkit-transform"]="translate3d(0,"+j+"px,0)",document.querySelector("#"+d+"_ul").style["-webkit-transition"]="all 0.100s ease-out",this.pos[d].callback=b,this.pos[d].maxY=j,this.pos[d].minY=j-this.pos[d].liH*(a.length-1),this.pos[d].top=j,this.pos[d].index=0,this.bindTouchEvent(d,b),this.slideBox.appendChild(f)},bindBaseEvent:function(){var a=this;document.getElementById("selector-cancle-btn").addEventListener("click",function(b){a.cancleEvent.call(a,b)}),document.getElementById("selector-set-btn").addEventListener("click",function(b){a.setEvent.call(a,b)})},bindTouchEvent:function(a,b){var c=this;this.doms.push(a),this.doms.map(function(a){var b=document.getElementById(a);b.addEventListener("touchstart",function(a){c.touchStart.call(c,a)}),b.addEventListener("touchmove",function(a){c.touchMove.call(c,a)}),b.addEventListener("touchend",function(a){c.touchEnd.call(c,a)})})},cancleEvent:function(a){},setEvent:function(a){},touchStart:function(a){a.preventDefault();var b=this.pos[a.currentTarget.id];b.startY=a.targetTouches[0].screenY,b.startX=a.targetTouches[0].screenX,b.top=b.top||0},touchMove:function(a){a.preventDefault();var b=a.currentTarget.id,c=document.getElementById(b+"_ul"),d=this.pos[b],e=0;d.endY=a.targetTouches[0].screenY,d.endX=a.targetTouches[0].screenX,e=.06*(d.endY-d.startY)+d.top,c.style["-webkit-transform"]="translate3d(0,"+e+"px,0)",d.top=e},touchEnd:function(a){a.preventDefault();var b=a.currentTarget.id,c=this.pos[b];this.enanimate(b),"function"==typeof c.callback&&c.callback(c.index,document.querySelectorAll("#"+b+" .selector-li")[c.index])},enanimate:function(a){var b=document.getElementById(a+"_ul"),c=this.pos[a],d=(c.maxY-c.minY+c.liH,c.top);return d=d>c.maxY?c.maxY:d,d=d<c.minY?c.minY:d,d!=c.top?(b.style["-webkit-transform"]="translate3d(0,"+d+"px,0)",c.top=d,c.index=Math.abs(Math.round((d-c.maxY)/c.liH)),!0):(c.index=Math.abs(Math.round((d-c.maxY)/c.liH)),d=c.maxY-c.index*c.liH,b.style["-webkit-transform"]="translate3d(0,"+d+"px,0)",c.top=d,void 0)},changeSlide:function(a,b,c){c=c||null;var d="selector-slideItem_"+a,e=null,f="",g="",h=this;e=document.querySelector("#"+d).querySelector(".selector-bf"),b.length?b.map(function(a){f="",g+=h.selectItem;for(var b in a)"text"==b&&(g=g.replace("{text}",a[b])),f+=b+'="'+a[b]+'"';g=g.replace("{data}",f)}):g=h.selectItem.replace("{data}","").replace("{text}",""),e.innerHTML=g,this.pos[d]=new Object,this.pos[d].liH=parseFloat(getDefaultStyle(this.slideBox.querySelector(".selector-li"),"height"));var i=2*this.pos[d].liH;document.querySelector("#"+d+"_ul").style["-webkit-transform"]="translate3d(0,"+i+"px,0)",document.querySelector("#"+d+"_ul").style["-webkit-transition"]="all 0.100s ease-out",this.pos[d].callback=c,this.pos[d].maxY=i,this.pos[d].minY=i-this.pos[d].liH*(b.length-1),this.pos[d].top=i,this.pos[d].index=0},removeSlide:function(a){var b=document.getElementById("selector-slideItem_"+a);this.slideBox.removeChild(b)},changeTitle:function(a){a&&(this.title.innerHTML=a)},setBoxPosition:function(){var a=this.box.scrollWidth,b=this.box.scrollHeight,c=parseFloat(document.documentElement.clientWidth),d=parseFloat(document.documentElement.clientHeight),e=0,f=0;e=d/2-b/2,f=c/2-a/2,this.box.style.top=e+"px",this.box.style.left=f+"px"},getNowChose:function(){var a=this,b=[];return this.doms.map(function(c){var d=document.getElementById(c);b.push(d.querySelectorAll(".selector-li")[a.pos[c].index])}),b},setPos:function(a,b,c){var d="selector-slideItem_"+a,e=document.querySelector("#"+d),f=e.querySelectorAll(".selector-li"),g=e.querySelector(".selector-li["+b+'="'+c+'"]'),h=document.getElementById(d+"_ul"),i=this.pos[d],j=0;for(var k in f)if(f[k]==g){j=k;break}var l=i.maxY-j*i.liH;h.style["-webkit-transform"]="translate3d(0,"+l+"px,0)",i.top=l,i.index=j}};var AreaSelector=function(a,b){var c={showEvent:"focus",hideEvent:"",areaData:{},dataModel:"",showCitys:!0,showDist:!0,callback:function(){}};this.model=new Selector({showTitle:!1}),this.settings=Object.extend(c,b),this.target=document.getElementById(a)};AreaSelector.prototype={init:function(){var a=".selector-li{width:100px;text-overflow:ellipsis;white-space:nowrap;}",b=this,c=document.createElement("style");c.innerHTML=a,document.body.appendChild(c),this.model.cancleEvent=function(a){b.cancleEvent.call(b,a)},this.model.setEvent=function(a){b.setEvent.call(b,a)},this.model.show=function(){b.showEvent.call(b)},this.model.drawModel(),this.model.bindBaseEvent(),this.initEvent(),this.append_provs();var d=this.append_citys();this.append_dists(d)},showEvent:function(){if(null==this.model.outter)return!1;var a,b,c,d=this.getVal(),e=this.target.getAttribute("area-value"),f=d.value.join(",");f!=e&&(e=e||"",e=e.split(","),a=e[0]||this.settings.areaData.provs.slice(0,1)[0].value,this.model.setPos(0,"value",a),b=this.settings.showCitys&&this.updateCity(a),this.model.setPos(1,"value",b),c=this.settings.showCitys&&this.settings.showDist&&this.settings.areaData.dists[b].slice(0,1)[0].value,this.updateDist(b),this.model.setPos(2,"value",e[2]||0)),this.model.outter.style.display="block"},cancleEvent:function(a){this.model.hide()},setEvent:function(a){var b=this.getVal();text=b.text.join(" "),this.target.value=text,value=b.value.join(","),this.target.setAttribute("area-value",value),this.model.hide(),"function"==typeof this.settings.callback&&this.settings.callback(value,text)},initEvent:function(){var a=this;this.target.addEventListener("focus",function(b){a.model.show()}),this.settings.hideEvent&&this.target.addEventListener(a.settings.hideEvent,function(b){a.model.show()})},initData:function(){},append_provs:function(){var a=this;this.model.createSlide(this.settings.areaData.provs,function(b,c){a.changeProv.call(a,b,c)})},append_citys:function(a){if(this.settings.showCitys){var b=this.settings.areaData.provs.slice(0,1)[0],c=this;if(a=a||b.value,this.settings.areaData.citys[a])return this.model.createSlide(this.settings.areaData.citys[a],function(a,b){c.changeCity.call(c,a,b)}),this.settings.areaData.citys[a].slice(0,1)[0].value}},append_dists:function(a){return this.settings.showCitys&&this.settings.showDist&&this.settings.areaData.dists[a]?(this.model.createSlide(this.settings.areaData.dists[a]),a):void 0},changeProv:function(a,b){if(!this.settings.showCitys)return!1;var c=this.updateCity(b.getAttribute("value"));this.settings.showDist&&this.updateDist(c)},changeCity:function(a,b){if(!this.settings.showDist)return!1;var c=b.getAttribute("value");this.settings.showDist&&this.updateDist(c)},updateCity:function(a,b){if(this.settings.showCitys){var c=this.settings.areaData.citys[a],d=c.slice(0,1)[0],e=this;return this.model.changeSlide(1,c,function(a,b){e.changeCity.call(e,a,b)}),d?d.value:""}},updateDist:function(a){this.settings.showCitys&&this.settings.showDist&&this.model.changeSlide(2,this.settings.areaData.dists[a]||"")},getVal:function(){var a=this.model.getNowChose(),b=[],c=[];return a.map(function(a){b.push(a.getAttribute("text")),c.push(a.getAttribute("value"))}),{text:b,value:c}}};